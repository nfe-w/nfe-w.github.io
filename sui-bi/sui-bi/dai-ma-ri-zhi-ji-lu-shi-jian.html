<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>My Logging Best Practices | NFE-W`S BLOG</title>
    <meta name="generator" content="VuePress 1.9.4">
    <link rel="icon" href="/assets/avatar.jpg">
    <meta name="description" content="Just a study note for myself">
    
    <link rel="preload" href="/assets/css/0.styles.35bcedcf.css" as="style"><link rel="preload" href="/assets/js/app.9560cdf5.js" as="script"><link rel="preload" href="/assets/js/2.3860c10d.js" as="script"><link rel="preload" href="/assets/js/23.21d933cb.js" as="script"><link rel="prefetch" href="/assets/js/10.3ad98984.js"><link rel="prefetch" href="/assets/js/11.1d1d4f3c.js"><link rel="prefetch" href="/assets/js/12.1c9bed86.js"><link rel="prefetch" href="/assets/js/13.9443e294.js"><link rel="prefetch" href="/assets/js/14.b123db89.js"><link rel="prefetch" href="/assets/js/15.6a578106.js"><link rel="prefetch" href="/assets/js/16.c74803e1.js"><link rel="prefetch" href="/assets/js/17.8aafbb96.js"><link rel="prefetch" href="/assets/js/18.ad72cc9e.js"><link rel="prefetch" href="/assets/js/19.4f7b7ed7.js"><link rel="prefetch" href="/assets/js/20.33c41533.js"><link rel="prefetch" href="/assets/js/21.a9abdf04.js"><link rel="prefetch" href="/assets/js/22.76aeb9d7.js"><link rel="prefetch" href="/assets/js/24.c388c30d.js"><link rel="prefetch" href="/assets/js/3.ecdaafbf.js"><link rel="prefetch" href="/assets/js/4.0c4f7f25.js"><link rel="prefetch" href="/assets/js/5.745c46fb.js"><link rel="prefetch" href="/assets/js/6.d4384980.js"><link rel="prefetch" href="/assets/js/7.05319014.js"><link rel="prefetch" href="/assets/js/8.1d30ec6b.js"><link rel="prefetch" href="/assets/js/9.bdb7d9b3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.35bcedcf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NFE-W`S BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/sui-bi/" class="nav-link router-link-active">
  随笔
</a></div><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/nfe-w/my-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/nfe-w" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/sui-bi/" class="nav-link router-link-active">
  随笔
</a></div><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/nfe-w/my-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Repo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/nfe-w" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>随笔</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/sui-bi/sui-bi/vuepress-pei-zhi-ji-lu.html" class="sidebar-link">VuePress 配置记录</a></li><li><a href="/sui-bi/sui-bi/filebeat-yu-logstash.html" class="sidebar-link">filebeat 与 logstash</a></li><li><a href="/sui-bi/sui-bi/valid-can-shu-xiao-yan-shi-yong-shuo-ming.html" class="sidebar-link">@Valid 参数校验使用说明</a></li><li><a href="/sui-bi/sui-bi/suppresswarnings-zhu-jie.html" class="sidebar-link">@SuppressWarnings() 注解参数</a></li><li><a href="/sui-bi/sui-bi/externalizable-yu-serializable-yi-tong.html" class="sidebar-link">Externalizable 与 Serializable 异同</a></li><li><a href="/sui-bi/sui-bi/java-zhong-de-xie-bian-yu-ni-bian.html" class="sidebar-link">Java 中的协变与逆变</a></li><li><a href="/sui-bi/sui-bi/java-zhong-hashmapde-put-yu-compute.html" class="sidebar-link">Java 中 HashMap 的 put 与 compute，computeIfAbsent 与 putIfAbsent 的区别</a></li><li><a href="/sui-bi/sui-bi/linux-fang-huo-qiang-bi-ji.html" class="sidebar-link">Linux 防火墙笔记</a></li><li><a href="/sui-bi/sui-bi/docker-xiang-guan.html" class="sidebar-link">docker 相关</a></li><li><a href="/sui-bi/sui-bi/mmac-docker-maven.html" class="sidebar-link">M1 Mac 使用 dockerfile-maven-plugin 插件 build 镜像报错问题</a></li><li><a href="/sui-bi/sui-bi/docker-bu-shu-elk.html" class="sidebar-link">docker 部署 ELK</a></li><li><a href="/sui-bi/sui-bi/logback-spring-chang-yong-pei-zhi.html" class="sidebar-link">logback-spring.xml 常用配置</a></li><li><a href="/sui-bi/sui-bi/spring-boot-xiang-mu-da-fat-jar-de-fang-fa.html" class="sidebar-link">spring-boot 项目打 fat-jar 的方法</a></li><li><a href="/sui-bi/sui-bi/linux-ming-ling-ji-lu.html" class="sidebar-link">Linux 命令记录</a></li><li><a href="/sui-bi/sui-bi/spring-cloud-xiang-guan.html" class="sidebar-link">spring-cloud 相关</a></li><li><a href="/sui-bi/sui-bi/dai-ma-ri-zhi-ji-lu-shi-jian.html" aria-current="page" class="active sidebar-link">My Logging Best Practices</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sui-bi/sui-bi/dai-ma-ri-zhi-ji-lu-shi-jian.html#log-after-not-before" class="sidebar-link">Log after, not before</a></li><li class="sidebar-sub-header"><a href="/sui-bi/sui-bi/dai-ma-ri-zhi-ji-lu-shi-jian.html#separate-parameters-and-messages" class="sidebar-link">Separate parameters and messages</a></li><li class="sidebar-sub-header"><a href="/sui-bi/sui-bi/dai-ma-ri-zhi-ji-lu-shi-jian.html#distinguish-between-warning-and-error" class="sidebar-link">Distinguish between WARNING and ERROR</a></li><li class="sidebar-sub-header"><a href="/sui-bi/sui-bi/dai-ma-ri-zhi-ji-lu-shi-jian.html#info-is-for-business-debug-for-technology" class="sidebar-link">INFO is for business, DEBUG for technology</a></li><li class="sidebar-sub-header"><a href="/sui-bi/sui-bi/dai-ma-ri-zhi-ji-lu-shi-jian.html#much-more" class="sidebar-link">Much more</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="my-logging-best-practices"><a href="#my-logging-best-practices" class="header-anchor">#</a> <a href="https://tuhrig.de/my-logging-best-practices/" target="_blank" rel="noopener noreferrer">My Logging Best Practices<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h1> <p>If you are a backend developer like me, logging is the window to your application. Unlike in the frontend, there’s not much to see except from some logging messages. Here are some of my personal guidelines I use when I write logs.</p> <h2 id="log-after-not-before"><a href="#log-after-not-before" class="header-anchor">#</a> Log after, not before</h2> <p>Back in the days, a logbook was written on every ship. It was like a diary which recorded important events throughout the day. And just like a traditional logbook, we should log things that had happened instead of things we are going to do.</p> <p>Let’s make an example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// don't do that
log.info(&quot;Making request to REST API&quot;)
restClient.makeRequest()
 
// do that
restClient.makeRequest()
log.info(&quot;Made request to REST API&quot;)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The first log statement doesn’t tell much. When reading it, you will not know if the REST call was successful or not. To do so you must look for the absence of an exception. And if you read this log but miss the subsequent exception you will be confused for the rest of the day (trust me).</p> <p>The second log is much better. It clearly states that the operation right before was successful. If the REST call would have failed, you would not see this log – there would be an exception instead.</p> <p>I apply this rule to all INFO logs. However I make exceptions for DEBUG.</p> <h2 id="separate-parameters-and-messages"><a href="#separate-parameters-and-messages" class="header-anchor">#</a> Separate parameters and messages</h2> <p>A typical log message contains two types of data. One type is a handwritten message which states was is going on. The second type is a list of (technical) parameters involved in the operation. You should try to separate both parts.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// don't do that
restClient.makeRequest()
log.info(&quot;Made request to {} on REST API.&quot;, url)
 
// do that
restClient.makeRequest()
log.info(&quot;Made request to REST API. [url={}]&quot;, url)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>The first log message has some flaws. It’s difficult to parse for example for Grok patterns. So it becomes harder to automatically extract IDs or parameters in our logging tool. It’s also difficult to read. Imagine having a very long URL possibly with a list of parameters at their end. Half of the log message might be out of your screen. And of course, the message is more difficult to extend. If you want to add another parameter (such as the HTTP method used) you must rewrite you whole sentence.</p> <p>The seconds version has none of these flaws. It’s easy to parse because the parameter list has a clear syntax. It’s easy to read, as you can see the sentence right up-front. And it’s easy to extend as you can just add another parameter to the list.</p> <h2 id="distinguish-between-warning-and-error"><a href="#distinguish-between-warning-and-error" class="header-anchor">#</a> Distinguish between WARNING and ERROR</h2> <p>Obviously, log levels are there for a reason and you should use them appropriately. And there are some key differences between a WARNING and an ERROR.</p> <p>If you did some operations which actually worked, but there have been some issues – that’s a WARNING. But if you did some operation and it simply didn’t work – that’s an ERROR.</p> <p>Let’s look at an example again:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>try {
    restClient.makeRequest()
    log.info(&quot;Made request to REST API. [url={}]&quot;, url)
} catch(e: UnauthorizedException) {
    log.warn(&quot;Request to REST API was rejected because user is unauthorized. [url={}, result={}]&quot;, url, result)
} catch(e: Exception) {
    log.error(&quot;Request to REST API failed. [url={}, exception={}]&quot;, url, exception)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>The REST call might have one of three outcomes:</p> <ul><li>It can work like a charm. That’s an INFO (<em>after</em> the call).</li> <li>It can fail with an unexpected exception. That’s an ERROR (<em>instead</em> of the INFO log).</li> <li>It can result in some expected exception. That’s a WARNING.</li></ul> <p>So in case of a WARNING, you did something, but you didn’t do it perfectly. In case of an ERROR you didn’t do it.</p> <p>Also note that a WARNING (and also an ERROR of course) is a call to action. If nobody needs to react and to do something, then you don’t need to log a WARNING.</p> <h2 id="info-is-for-business-debug-for-technology"><a href="#info-is-for-business-debug-for-technology" class="header-anchor">#</a> INFO is for business, DEBUG for technology</h2> <p>The INFO log should look like a book. It should tell you what had happened, not necessarily how. This means that INFO is better suited for business-like log messages compared to technical stuff. Technical related messages should (usually) be DEBUG.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INFO  | User registered for newsletter. [user=&quot;Thomas&quot;, email=&quot;thomas@tuhrig.de&quot;]
INFO  | Newsletter send to user. [user=&quot;Thomas&quot;]
INFO  | User unsubscribed from newsletter. [user=&quot;Thomas&quot;, email=&quot;thomas@tuhrig.de&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This type of log tells you a story from the point of view of our business. Now what are technical logs?</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>DEBUG | Saved user to newsletter list. [user=&quot;Thomas&quot;, email=&quot;thomas@tuhrig.de&quot;]
DEBUG | Send welcome mail. [user=&quot;Thomas&quot;, email=&quot;thomas@tuhrig.de&quot;]
INFO  | User registered for newsletter. [user=&quot;Thomas&quot;, email=&quot;thomas@tuhrig.de&quot;]
DEBUG | Started cron job to send newsletter of the day. [subscribers=24332]
INFO  | Newsletter send to user. [user=&quot;Thomas&quot;]
INFO  | User unsubscribed from newsletter. [user=&quot;Thomas&quot;, email=&quot;thomas@tuhrig.de&quot;]
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Every (business) use-case results in a single line of INFO log. Additionally, there are DEBUG logs which give a more detailed insight in how the process works.</p> <h2 id="much-more"><a href="#much-more" class="header-anchor">#</a> Much more</h2> <p>Of course, there’s much more to do for good logs. You also need to consider things like tracing, log aggregation and metrics. But when it comes down to the pure writing, I really recommend those little rules.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sui-bi/sui-bi/spring-cloud-xiang-guan.html" class="prev">
        spring-cloud 相关
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.9560cdf5.js" defer></script><script src="/assets/js/2.3860c10d.js" defer></script><script src="/assets/js/23.21d933cb.js" defer></script>
  </body>
</html>
