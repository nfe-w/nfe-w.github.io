(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{400:function(s,t,a){"use strict";a.r(t);var n=a(54),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"linux-防火墙笔记"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linux-防火墙笔记"}},[s._v("#")]),s._v(" Linux 防火墙笔记")]),s._v(" "),a("h2",{attrs:{id:"使用-firewalld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-firewalld"}},[s._v("#")]),s._v(" 使用 firewalld")]),s._v(" "),a("p",[s._v("官方文档 "),a("code",[s._v("https://fedoraproject.org/wiki/FirewallD/zh-cn")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl status firewalld  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看防火墙状态")]),s._v("\nsystemctl start firewalld   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启防火墙")]),s._v("\nsystemctl stop firewalld    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" firewalld  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开机自启")]),s._v("\nsystemctl disable firewalld "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取消开机自启")]),s._v("\n\nfirewall-cmd --state        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看防火墙状态")]),s._v("\nfirewall-cmd --list-all     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看规则")]),s._v("\n\nfirewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --query-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看某端口状态")]),s._v("\nfirewall-cmd --reload "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下操作，重新加载防火墙配置才会起作用")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --permanent 永久生效，没有此参数重启后失效")]),s._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("–-zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("-–timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nfirewall-cmd --permanent --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开放端口")]),s._v("\nfirewall-cmd --permanent --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("-2000/tcp "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开放端口段")]),s._v("\nfirewall-cmd --permanent --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --remove-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/tcp     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭端口")]),s._v("\n\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=192.168.1.1 accept'")]),s._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放通某个IP访问")]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=192.168.1.0/24 accept'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放通某个IP段访问")]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=192.168.1.1 drop'")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止某个IP访问")]),s._v("\nfirewall-cmd --permanent --remove-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=192.168.1.1 accept'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除规则")]),s._v("\n\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=192.168.1.1 port protocol=tcp port=6379 accept'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放通某个IP访问某端口")]),s._v("\nfirewall-cmd --permanent --add-rich-rule"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rule family=ipv4 source address=192.168.1.1 port protocol=tcp port=6379 drop'")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 禁止某个IP访问某端口")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("h2",{attrs:{id:"使用-iptables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-iptables"}},[s._v("#")]),s._v(" 使用 iptables")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" iptables save "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保存iptables，否则数重启后失效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/sysconfig/iptables "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables 规则文件")]),s._v("\n\niptables -nL "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("--line-numbers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列出(list)指定链中所有的规则进行查看，显示规则编号")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 链：INPUT、OUTPUT、FORWARD")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 链的规则匹配逻辑：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.从上往下依次匹配")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.一但匹配上，就不再往下匹配了")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3.默认规则是放行所有")]),s._v("\n\niptables -F "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 清空（flush）所有规则，不会处理默认的规则")]),s._v("\niptables -A "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在指定链添加(append)一条规则，末尾")]),s._v("\niptables -I "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在指定链插入(insert)一条规则，默认第一行")]),s._v("\niptables -D "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除(delete)指定链中的某一条规则，可以按规则序号和内容删除")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -D INPUT 序号 # 删除指定链上的指定序号")]),s._v("\niptables -P "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置指定链的默认策略（policy）")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -p协议，-s源地址，-d目标地址，--sport源端口，--dport目标端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -j处理动作 ACCEPT、DROP、REJECT、REDIRECT")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 常用")]),s._v("\niptables -I INPUT -p icmp -j REJECT "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝进入防火墙的所有ICMP协议数据包")]),s._v("\niptables -A FORWARD -p "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" icmp -j ACCEPT "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许防火墙转发除ICMP协议以外的所有数据包")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拒绝来自192.168.1.10主机的数据，允许来自192.168.0.0/24网段的数据；注意要把拒绝的放在前面，不然不起作用")]),s._v("\niptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.11 -j REJECT\niptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/24 -j ACCEPT\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只开放本机的80、20、21、20450-20480，放行外部主机发住服务器其它端口的应答数据包，将其他入站数据包均予以丢弃处理。")]),s._v("\niptables -I INPUT -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20,21")]),s._v(",80 -j ACCEPT\niptables -I INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20450")]),s._v(":20480 -j ACCEPT\niptables -I INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT\niptables -P INPUT DROP\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 封禁某个ip")]),s._v("\niptables -I INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.7 -j DROP\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 封掉3306端口")]),s._v("\niptables -I INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" -j DROP\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 除了127.0.0.1以外，禁止任何访问9091、9092、9093端口，-d感觉替换成-s也可以")]),s._v("\niptables -I INPUT                -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9091,9092")]),s._v(",9093 -j DROP\niptables -I INPUT   -d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9091,9092")]),s._v(",9093 -j ACCEPT\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或（未测试）")]),s._v("\niptables -I INPUT "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 -p tcp -m multiport --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9091,9092")]),s._v(",9093 -j DROP\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);